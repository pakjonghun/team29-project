<!DOCTYPE html>
<html lang="en">
<head>
    <meta property="og:title" content="ê¸°ì–µë³´ë‹¤ëŠ” ê¸°ë¡ì„" />
    <meta property="og:description" content="ì–´ì œ ë³´ë‹¤ ë‚˜ì€ ê°œë°œìê°€ ë˜ê¸° ìœ„í•´ ì˜¤ëŠ˜ ê³µë¶€í•œ ê²ƒì„ ê¸°ë¡í•˜ê³ ,  í•¨ê»˜ ê³µìœ í•˜ë©°, ê¸°ë¡í•œ ë‚´ìš©ì„ ë¦¬ë·°í•  ìˆ˜ ìˆëŠ” ì‚¬ì´íŠ¸." />
    <meta property="og:image" content="{{ url_for('static', filename='ogimage.png') }}" />

    <meta charset="UTF-8">
    <title>ê¸°ì–µë³´ë‹¨ ê¸°ë¡ì„ | íšŒì›ê°€ì…</title>
    <link href="{{ url_for('static', filename='./css/login.css') }}" rel="stylesheet">
    <link rel="shortcut icon" href="/static/img/favicon.ico" type="image/x-icon">
    <script>

        let errorPoint = {
            nickName: false,
            password: false,
            passwordConfirm: false,
        };


        function showErrorMsg(target, msg, chk) {
            const valid = document.querySelector(target);
            if (chk) {
                valid.setAttribute('class', 'help-show');
                valid.innerHTML = msg;
            } else {
                valid.setAttribute('class', 'help');
            }

        }

        function checkErroPoint(errorName, chk) {
            if (chk) errorPoint[errorName] = false;
            else errorPoint[errorName] = true;

            let isError = false;
            let keys = Object.keys(errorPoint);

            for (let i = 0; i < keys.length; i++) {
                if (!errorPoint[keys[i]]) {
                    isError = true;
                    break;
                }
            }
            const btn = document.querySelector(".login_btn");
            if (!isError) {
                btn.removeAttribute('disabled');
            } else {
                btn.setAttribute("disabled", "disabled");
            }
        }

       async function createAccount() {
            const nickName = document.querySelector("#nickName");
            const password = document.querySelector("#password");


            if (!await isDup(nickName.value)) {

                showErrorMsg('#help-nickName', 'ì¤‘ë³µë˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.', true);
                checkErroPoint('nickName', true);
                nickName.focus();
            } else {
                showErrorMsg('#help-nickName', 'None.', false);
                checkErroPoint('nickName', false);

                const formData = new FormData();
                formData.append('nickName', nickName.value);
                formData.append('password', password.value);

                try {
                    await fetch('/user/join', {
                        method: 'POST',
                        body: formData,
                    }).then(alert('íšŒì›ê°€ì…ë˜ì—ˆìŠµë‹ˆë‹¤.'));
                    window.location.href = '/user/login';
                } catch (error) {
                    console.error(error);
                }

            }
        }

        async function isDup(value) {
            try {
                let url = '/user/dupCheck?nickName=' + value
                const response = await (await fetch(url, {
                    method: 'GET',
                })).json();
                return response.result
            } catch (error) {
                console.error(error);
            }
        }

        function isValidNickName() {
            const nickName = document.querySelector("#nickName");
            const value = nickName.value

            if (!is_nickname(value)) {

                showErrorMsg('#help-nickName', 'ë‹‰ë„¤ì„ì˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.<br/>ì˜ë¬¸ê³¼ ìˆ«ì, ì¼ë¶€ íŠ¹ìˆ˜ë¬¸ì(._-) ì‚¬ìš© ê°€ëŠ¥. 2-10ì ê¸¸ì´', true);
                checkErroPoint('nickName', true);
                nickName.focus();
                return;
            }
            showErrorMsg('#help-nickName', 'None', false);
            checkErroPoint('nickName', false);
        }

        function isValidPassword(value) {
            const password = document.querySelector("#password");
            const passwordConfirm = document.querySelector("#passwordConfirm");
            if (!is_password(value)) {
                showErrorMsg('#help-password', 'ë¹„ë°€ë²ˆí˜¸ì˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.<br/>ì˜ë¬¸ê³¼ ìˆ«ì í•„ìˆ˜ í¬í•¨, íŠ¹ìˆ˜ë¬¸ì(!@#$%^&*) ì‚¬ìš©ê°€ëŠ¥ 8-20ì', true);
                checkErroPoint('password', true);
                password.focus();
                return;
            }


            if (passwordConfirm.value !== "") {
                if (passwordConfirm.value !== password.value) {
                    showErrorMsg('#help-password', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
                    checkErroPoint('password', true);
                    password.focus();
                    return;
                }
            }
            showErrorMsg('#help-password', 'None', false);
            checkErroPoint('password', false);

        }

        function isValidPasswordConfirm(value) {
            const password = document.querySelector("#password")
            const passwordConfirm = document.querySelector("#passwordConfirm");

            if (!is_password(value)) {
                showErrorMsg('#help-passwordConfirm', 'ë¹„ë°€ë²ˆí˜¸ì˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.<br/>ì˜ë¬¸ê³¼ ìˆ«ì í•„ìˆ˜ í¬í•¨, íŠ¹ìˆ˜ë¬¸ì(!@#$%^&*) ì‚¬ìš©ê°€ëŠ¥ 8-20ì', true);
                checkErroPoint('passwordConfirm', true);
                passwordConfirm.focus();
                return;
            }
            if (password.value !== passwordConfirm.value) {
                showErrorMsg('#help-passwordConfirm', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
                checkErroPoint('passwordConfirm', true);
                passwordConfirm.focus();
                return;
            }
            showErrorMsg('#help-passwordConfirm', 'None', false);
            checkErroPoint('passwordConfirm', false);
        }

        function is_nickname(asValue) {
            let regExp = /^(?=.*[a-zA-Z])[-a-zA-Z0-9_.]{2,10}$/;
            return regExp.test(asValue);
        }

        function is_password(asValue) {
            let regExp = /^(?=.*\d)(?=.*[a-zA-Z])[0-9a-zA-Z!@#$%^&*]{8,20}$/;
            return regExp.test(asValue);
        }
    </script>
</head>
<body>
<h1 class="title">  ğŸ“– ê¸°ì–µë³´ë‹¨ ê¸°ë¡ì„</h1>
<h1 class="warning"> í™”ë©´ì´ ì¢ìŠµë‹ˆë‹¤. ë„“í˜€ì£¼ì„¸ìš”.</h1>
<main class="login">
    <div class="form">
        <input type="text" placeholder="NickName" name="nickName" id="nickName" onkeyup="isValidNickName()" required>
        <span id="help-nickName" class="help"></span>
        <input type="password" placeholder="Password" name="password" id="password" onkeyup="isValidPassword(value)"
               required>
        <span id="help-password" class="help">ì˜ë¬¸ê³¼ ìˆ«ì ì¡°í•©ì˜ 8-20ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. íŠ¹ìˆ˜ë¬¸ì(!@#$%^&*)ë„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>
        <input type="password" placeholder="PasswordConfirm" name="passwordConfirm" id="passwordConfirm"
               onkeyup="isValidPasswordConfirm(value)" required>
        <span id="help-passwordConfirm" class="help">ì˜ë¬¸ê³¼ ìˆ«ì ì¡°í•©ì˜ 8-20ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. íŠ¹ìˆ˜ë¬¸ì(!@#$%^&*)ë„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>
        <button onclick="createAccount()" class="login_btn" disabled>íšŒì›ê°€ì…</button>
    </div>

    <div class="bottom_box">
        <span style="font-size: 0.9em;">ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?</span>
        <button onclick="window.location.href='/user/login'">ë¡œê·¸ì¸</button>
    </div>
</main>

</body>
</html>